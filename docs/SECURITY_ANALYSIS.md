# 機密情報管理のセキュリティ分析

## マイクロサービスによる機密情報管理 (`art-gallery-secrets-api`)

### 現在のアーキテクチャ
本システムでは、一般的な環境変数による管理から一歩進み、**パスワード復号専用のマイクロサービス (`art-gallery-secrets-api`)** を導入しています。

### セキュリティ上の利点

1. **暗号化キーの局所化**
   - 復号に必要な `SECRET_KEY` を保持するのは `secrets-api` コンテナのみです。
   - `backend` や `database` コンテナは復号キーを持つ必要がなく、コンテナが侵害された際の被害を最小限に抑えます。

2. **ワンタイムトークンによる配布**
   - 起動時に生成される安全なワンタイムトークン (`backend_token.txt`) を使用して認証します。
   - トークンは一度使用されると即座に破棄されるため、リプレイアタックを防ぎます。

3. **攻撃表面の最小化（揮発性サービス）**
   - `secrets-api` はパスワードの配布が完了するか、起動から5分経過すると自動的にシャットダウンします。
   - 実行時間を最小限にすることで、外部からの攻撃を受ける時間を極限まで減らします。

4. **ネットワーク分離**
   - Docker内部ネットワークのみで通信し、ホストマシンや外部ネットワークからは一切アクセスできません。

## 他の管理手法との比較

### 1. 環境変数のみでの管理
- **リスク**: プロセス一覧やクラッシュダンプから漏洩する可能性。
- **比較**: 現在の方式はメモリ上に常駐する秘密情報を減らせるため、より安全です。

### 2. 暗号化された設定ファイル（ローカル復号）
- **リスク**: すべてのコンテナに復号ロジックとキーを配布する必要がある。
- **比較**: 現在の方式は復号ロジックを1箇所に集約しており、保守性と安全性が高いです。

## 現在の実装の評価

### セキュリティレベル: **高 (High)**

**評価ポイント**:
- ✅ 復号キーの露出を最小限に抑制（1コンテナのみ）
- ✅ ワンタイムトークンによる厳格なアクセス制御
- ✅ 配布完了後の自動プロセス終了による安全性確保
- ✅ ネットワーク分離による外部アクセス遮断

## まとめ

現在の `art-gallery-secrets-api` を用いた管理手法は、小規模〜中規模のマイクロサービスアーキテクチャにおいて非常に高いセキュリティレベルを提供しています。これは、エンタープライズ向けの Vault サービスに近い概念を、軽量かつ安全に実装したものです。

